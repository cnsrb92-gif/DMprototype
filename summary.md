# DM Prototype - 프로젝트 작업 요약

> 작성일: 2026-02-19  
> 프로젝트 경로: `d:\dmprototype`

---

## 📌 프로젝트 개요

**DM Prototype**은 Gemini AI를 활용한 모바일 메신저 스타일의 캐릭터 채팅 웹 애플리케이션입니다.  
사용자가 AI 캐릭터들과 실제 메신저처럼 대화하고, 관계 점수와 데이트 텐션을 쌓아 데이트 이벤트까지 진행할 수 있는 인터랙티브 게임형 앱입니다.

---

## 🛠️ 기술 스택

| 구분 | 기술 |
|------|------|
| 프레임워크 | React 19 + Vite 7 |
| 스타일링 | TailwindCSS 4 |
| AI 엔진 | Google Gemini API (`gemini-2.5-flash-preview`) |
| 아이콘 | lucide-react |
| 빌드/서버 | Vite (dev / share 네트워크 공유) |
| 배포 방식 | `start_share.bat` 실행 → 로컬 네트워크 공유 |

---

## 📁 프로젝트 구조

```
dmprototype/
├── src/
│   ├── App.jsx              # 메인 애플리케이션 (전체 게임 로직 포함)
│   ├── main.jsx             # React 진입점
│   ├── index.css            # 전역 스타일 (애니메이션 포함)
│   └── assets/
│       └── characters/      # 캐릭터 이미지 에셋
│           ├── ann.svg.png          # 앤 아바타
│           ├── ann_levelup.svg.png  # 앤 레벨업 이미지
│           ├── ann_photocard.png    # 앤 포토카드 (데이트 보상)
│           ├── nera.svg.png         # 네라 아바타
│           ├── nera_levelup.svg.png
│           ├── nera_photocard.png
│           ├── sofia.svg.png        # 소피아 아바타
│           ├── sofia_levelup.svg.png
│           └── sofia_photocard.png
├── public/
├── start_share.bat          # 네트워크 공유 서버 실행 스크립트
├── .env.example             # 환경변수 예시 (VITE_GEMINI_API_KEY)
├── package.json
├── vite.config.js
├── tailwind.config.js
└── postcss.config.js
```

---

## 🎮 핵심 게임 시스템

### 1. 캐릭터 시스템

총 3명의 AI 캐릭터가 존재합니다.

| 캐릭터 | 설명 | 성격 | 말투 |
|--------|------|------|------|
| **앤 (Ann)** | 버밀리온 제국 제1황녀 | 활발함 (골든 리트리버) | 반말, 애교, 직설적 |
| **네라 (Nera)** | 귀차니즘 뱀파이어 | 귀차니즘, 츤데레 | 반말, 귀찮음, 하대 |
| **소피아 (Sofia)** | 모델 겸 대학생 | 다정함, 얀데레 기질 | 존댓말/반말 혼용 |

### 2. 관계 점수 (Relationship Score)

- 0~100점 사이 값으로 관리
- AI 응답의 `||SCORE:+n||` / `||SCORE:-n||` 태그로 자동 변동
- 레벨업 시 팝업 모달로 알림

| 점수 구간 | 관계 단계 |
|----------|----------|
| 0 ~ 19 | 혐오 👿 |
| 20 ~ 39 | 무관심 😐 |
| 40 ~ 59 | 보통 🙂 |
| 60 ~ 79 | 친함 🥰 |
| 80 ~ 100 | 썸 💘 |

### 3. 데이트 텐션 (Dating Tension)

- 0~100% 사이 값으로 관리
- AI 응답의 `||TENSION:+n||` / `||TENSION:-n||` 태그로 자동 변동
- **100%** 달성 시 "데이트 하러가기" 버튼 표시
- 데이트 완료 후 캐릭터 **포토카드** 지급

### 4. 에너지 레벨 (Energy Level)

캐릭터의 현재 상태에 따라 응답 스타일이 달라집니다.

| 에너지 | 특징 |
|--------|------|
| High | 이모티콘 多, 말풍선 여러 개로 분리 |
| Normal | 적절한 이모티콘, 보통 응답 |
| Low | 단답형, 귀찮음 표현, 이모티콘 없음 |

---

## 🤖 AI 프롬프트 구조

Gemini API에 전달되는 시스템 프롬프트는 다음 정보를 동적으로 조합합니다:

```
[캐릭터 설정]
- 이름, 자아, 성격, 말투

[현재 상태]
- 관계 단계 및 점수
- 에너지 레벨 및 설명
- 데이트 텐션 %

[지시사항]
1. 한국어 메신저 말투
2. 에너지 레벨에 맞는 응답 길이
3. 말풍선 수 지정 (1~3개, 한 말풍선당 20자 이내)
4. 늦은 답장 반응 (관계 레벨에 따라 다름)
5. 이전 대화 15개 메시지 컨텍스트 포함
6. SCORE / TENSION 태그 응답에 포함
```

### 말풍선 분리 시스템 (`||SPLIT||`)
- AI 응답 내 `||SPLIT||` 기준으로 텍스트를 분리
- 각 말풍선은 700ms + 랜덤 300ms 딜레이로 순차 표시
- 실제 메신저처럼 자연스러운 타이핑 효과 구현

---

## 💬 채팅 UI 기능

### 화면 구성
1. **API Key 입력 화면**: 최초 실행 시 Gemini API Key 입력 (localStorage에 저장)
2. **채팅 목록 화면**: 3명 캐릭터 목록, 읽지 않은 메시지 배지
3. **채팅방 화면**: 실제 메신저 스타일 UI

### 채팅방 세부 기능
- **상태바**: 실시간 시계 + 신호/WiFi/배터리 아이콘
- **데이트 텐션 바**: 헤더에 그라디언트 프로그레스 바 + 텐션 상태 텍스트
- **타이핑 인디케이터**: AI 응답 대기 중 `...` 애니메이션 표시
- **메시지 타입**: 텍스트, 이미지(포토카드), 시스템 메시지
- **선물 메뉴**: `+` 버튼으로 열리는 슬라이드업 패널

---

## 🎁 선물 시스템

채팅방 하단 `+` 버튼으로 선물 전송 가능합니다.

| 선물 | 아이콘 | 효과 |
|------|--------|------|
| 치킨 기프티콘 | 🍗 | 데이트 텐션 +10 |
| 명품 가방 | 💎 | 데이트 텐션 +30 |
| 강남 아파트 | 🏢 | 관계 점수 +20 |

선물 전송 시 AI가 자동으로 감동 리액션 생성 (별도 Gemini API 호출)

---

## 📳 자동 메시지 (트리거 시스템)

- 5초마다 40% 확률로 랜덤 캐릭터가 먼저 메시지 전송
- 현재 채팅 중인 캐릭터는 제외
- 미읽음 10개 이상 시 추가 전송 중단
- 미읽음 3개 이상 누적 시 데이트 텐션 -5 페널티
- 메시지 수신 시 **알림음** 재생 + **토스트 팝업** 표시

### 늦은 답장 처리
- 2개 이상 미읽음 & 10분 이상 경과 시 관계 레벨별 다른 반응:
  - 혐오/무관심: 짜증, 무관심 반응
  - 보통: 서운함 표현
  - 친함/썸: 걱정, 그리움 표현

---

## 💖 데이트 이벤트

데이트 텐션 100% 달성 후 스마트폰 UI처럼 생긴 "데이트 하러가기" 버튼이 표시됩니다.

**진행 순서:**
1. 버튼 클릭 → 랜덤 데이트 시나리오 선택
2. 데이트 완료 팝업 표시 및 후일담 확인
3. 캐릭터가 후일담 대화 + **포토카드** 이미지 전송
4. 데이트 텐션 0으로 초기화

**데이트 시나리오 예시:**
- 한강에서 치맥 먹기 🍗🍺
- 놀이공원 데이트 🎡
- 영화관 데이트 🍿
- 분위기 좋은 카페 ☕

---

## 🖥️ 실행 방법

### 개발 서버 시작
```bash
npm run dev
```

### 네트워크 공유 (같은 WiFi 내 다른 기기에서 접속)
```bash
# 방법 1: bat 파일 더블클릭
start_share.bat

# 방법 2: 터미널
npm run share
```

### 환경변수 설정 (선택)
`.env.example`을 복사해 `.env` 파일 생성 후 API Key 입력:
```env
VITE_GEMINI_API_KEY=your_gemini_api_key_here
```
※ API Key는 앱 내 입력 화면에서도 직접 입력 가능하며 `localStorage`에 저장됩니다.

---

## 🎨 UI/디자인 특징

- **모바일 퍼스트**: `max-w-[430px]` 스마트폰 형태 UI
- **데스크탑**: 스마트폰 프레임(테두리, 카메라 노치, 하단 홈바) 렌더링
- **애니메이션**: `fadeIn`, `slideUp` 커스텀 CSS 애니메이션
- **폰트**: Inter, San Francisco, Segoe UI 계열
- **스토리 링 UI**: 읽지 않은 메시지 있을 시 인스타그램 스타일 그라디언트 링

---

## 📋 향후 개선 가능 포인트

- [ ] 로컬 스토리지를 통한 게임 진행 상태 저장/불러오기
- [ ] 캐릭터 추가 (현재 3명 → 확장 가능한 구조)
- [ ] 에너지 레벨 자동 변동 로직 (시간대별)
- [ ] 미니게임 추가 (호감도 상승 활동)
- [ ] BGM / 효과음 강화
- [ ] 다국어 지원 (현재 한국어 전용)
